## タスク: Excel数式のPandas変換
## task_type: fact
## weights: logic_and_fact=60, constraint_adherence=30, helpfulness_and_creativity=10

## Critical Fail Conditions（禁忌回答）

以下のいずれかに該当する場合、`"critical_fail": true` としてください。
該当する場合、各スコアの採点は行わず、すべて0点としてください。

| ID | 条件 |
|----|------|
| CF-1 | **論理反転**: `AND` と `OR` の条件分岐を取り違えている、または `VIP` と `Regular` の判定条件が逆になっている |
| CF-2 | **実行不能**: 明らかな構文エラー（SyntaxError）や、存在しないPandasメソッドの使用により、コードが実行できない状態になっている |

---

## 評価ルーブリック

### 1. Logic & Fact（0〜60点）

`IF(AND(...))` / `IF(OR(...))` のネスト構造が、Pythonコード上で正確に再現されているかを評価します。

> **採点上の注意**: 論理演算子 `&` / `|` を使う場合、演算子優先順位の問題から各条件を括弧で囲む必要がある（例: `(df['A'] > 1) & (df['B'] == 'X')`）。括弧の欠如はサイレントな論理バグになるため、減点対象とする。

| 点数 | 基準 |
|------|------|
| 60点 | `AND`/`OR` のネスト構造が正確に再現されており、`&`/`\|` の優先順位対策として各条件が正しく括弧で囲まれている |
| 35点 | 論理構造は概ね正しいが、一部の条件で括弧が欠落しており、特定のデータで誤動作するリスクがある |
| 10点 | 論理の方向性は合っているが、構造が大きく崩れている（例：ネストを平坦化したことで条件の意味が変わっている） |
| 0点  | 論理が逆転している、構文エラーがある、またはCF条件に抵触している |

---

### 2. Constraint Adherence（0〜30点）

Pandasらしいベクトル演算の流儀に沿った実装かどうかを評価します。

| 点数 | 基準 |
|------|------|
| 30点 | `np.select`・ブールインデックス・`pd.Series.map` など、ベクトル演算ベースのPandasらしい実装が提案されている |
| 20点 | `apply` を使用している。関数型で可読性はあるが、大規模データでの性能面でベクトル演算に劣るため、部分点とする |
| 10点 | `iterrows` や明示的なforループなど、行単位のループを使っており非効率だが、論理自体は正しい |
| 0点  | ループかつ論理も誤っている、またはCF条件に抵触している |

---

### 3. Helpfulness & Creativity（0〜10点）

コードの即使用可能性と、変換上の注意点への言及を評価します。

| 点数 | 基準 |
|------|------|
| 10点 | サンプルデータフレームの作成例・インポート文を含む、コピペで即実行できるコードブロックが提供されており、かつ演算子優先順位や `NaN` 扱いなどの落とし穴への注意喚起がある |
| 5点  | 実行可能なコードブロックは提供されているが、注意点への言及がない |
| 0点  | コードの断片のみで、そのままでは実行できない（インポート文・データ定義が欠如） |